<!DOCTYPE html>
<html>
<head>
    <style>
        body { overflow: hidden; background: transparent; margin: 0; height: 100vh; }
        
        .cat-instance {
            position: absolute;
            top: 75%; 
            transform: translateY(-50%);
            text-align: center;
            animation: walk-limited 12s linear infinite;
        }

        .cat-image { 
            width: 140px; 
            display: block;
            transition: width 0.3s ease;
        }

        .sender-name { 
            font-family: 'Arial', sans-serif; 
            color: #ff0050; 
            font-size: 18px; 
            font-weight: bold; 
            text-shadow: 2px 2px #fff;
            margin-bottom: 5px;
            /* Yazının ters dönmesini engelleyen animasyon */
            animation: flip-text 12s linear infinite;
        }

        .fade-out {
            animation: fadeout 1.5s forwards;
        }

        @keyframes fadeout {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Kedi için yürüyüş ve aynalama animasyonu */
        @keyframes walk-limited {
            0% { left: 5%; transform: translateY(-50%) scaleX(-1); }
            45% { transform: translateY(-50%) scaleX(-1); }
            50% { left: 60%; transform: translateY(-50%) scaleX(1); }
            95% { transform: translateY(-50%) scaleX(1); }
            100% { left: 5%; transform: translateY(-50%) scaleX(1); }
        }

        /* Yazının kediyle birlikte ters dönmesini engelleyen ters-aynalama */
        @keyframes flip-text {
            0% { transform: scaleX(-1); }
            45% { transform: scaleX(-1); }
            50% { transform: scaleX(1); } /* Kedi ters döndüğünde yazı da ters döner, -1 * -1 = +1 (Düz) olur */
            95% { transform: scaleX(1); }
            100% { transform: scaleX(1); }
        }
    </style>
</head>
<body>
    <div id="cat-field"></div>

    <script>
        // TikFinity'nin yerel WebSocket adresine bağlanıyoruz
        const socket = new WebSocket('ws://localhost:21213/');
        const activeCats = {};

        socket.onopen = () => {
            console.log("TikFinity bağlantısı başarılı!");
        };

        socket.onmessage = (event) => {
            const msg = JSON.parse(event.data);
            
            // TikFinity'den gelen veri 'gift' ise kediyi oluştur/büyüt
            if (msg.event === 'gift') {
                // 'uniqueId' kullanıcı adını temsil eder
                createOrGrowCat(msg.data.uniqueId);
            }
        };

        socket.onerror = (error) => {
            console.error("Bağlantı hatası:", error);
        };

        function createOrGrowCat(userName) {
            const field = document.getElementById('cat-field');

            if (activeCats[userName]) {
                const catObj = activeCats[userName];
                catObj.scale += 0.2; 
                if (catObj.scale > 3) catObj.scale = 3;

                const img = catObj.element.querySelector('.cat-image');
                const nameDiv = catObj.element.querySelector('.sender-name');
                
                img.style.width = (140 * catObj.scale) + "px";
                nameDiv.style.fontSize = (18 * catObj.scale) + "px";

                clearTimeout(catObj.timer);
                catObj.timer = setTimeout(() => removeCat(userName), 30000);
                
            } else {
                const catDiv = document.createElement('div');
                catDiv.className = 'cat-instance';
                
                catDiv.innerHTML = `
                    <div class="sender-name">${userName}</div>
                    <img class="cat-image" src="kedi.gif" alt="kedi">
                `;

                field.appendChild(catDiv);

                activeCats[userName] = {
                    element: catDiv,
                    scale: 1,
                    timer: setTimeout(() => removeCat(userName), 30000)
                };
            }
        }

        function removeCat(userName) {
            const catObj = activeCats[userName];
            if (catObj) {
                catObj.element.classList.add('fade-out');
                setTimeout(() => {
                    catObj.element.remove();
                    delete activeCats[userName];
                }, 1500);
            }
        }

        // Test için tıkla
        document.body.onclick = () => {
            createOrGrowCat("ZEYDLENDIN_TEST");
        };
    </script>
</body>
</html>